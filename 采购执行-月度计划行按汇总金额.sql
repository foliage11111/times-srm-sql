---这里碰到了最麻烦的问题，不同语言环境查出来的数据居然不一样，需要设置为中文的才行--将语言改为英语：ALTER SESSION SET NLS_LANGUAGE=american;--将地域改为英文：ALTER SESSION SET NLS_TERRITORY=america;--将语言改回中文：ALTER SESSION SET NLS_LANGUAGE='SIMPLIFIED CHINESE';--将地域改为中文：ALTER SESSION SET NLS_TERRITORY=CHINA;--enter po ,out_put plan_numberselect cph.header_id ,cph.PLAN_NAME,cph.PLAN_NUMBER,cph.VERSION_NUM,cph.PLAN_STATUS from   cux_pr_plan_headers cph       ,cux_pr_plan_headers cph2 where cph.contract_id = cph2.contract_id        and cph2.plan_number = 'S201706015'   ---source pr_plan                     ---version_control        and cph.plan_status='ORDERED';---show every plan's sum price by category,query by plan_numberselect cph.PLAN_NUMBER,cph.PLAN_STATUS,cph.VERSION_NUM,sum(cpl.unit_price*cpl.quantity),sum(cpl.unit_price*cpl.quantity)/275 from cux_pr_plan_lines cpl ,cux_pr_plan_headers cph where       cpl.header_id =cph.header_id                 and cph.CONTRACT_ID = (select cph2.contract_id from cux_pr_plan_headers cph2 where cph2.plan_number= 'S201711042')     ---本条件跟分类关联      and   (        SELECT t.segment1 || '.' || t.segment2 || '.' || t.segment3 category_code        FROM   mtl_categories t        WHERE  t.category_id = cpl.category_id) =       (SELECT distinct t.segment1 || '.' || t.segment2 || '.' || t.segment3 category_code         FROM   mtl_categories t         WHERE  t.DESCRIPTION like '%混凝土高精砌块%'  ) --本条件控制最后一个版本  AND    cph.last_update_date =       (SELECT MAX(cphh.last_update_date)         FROM   cux_pr_plan_headers cphh         WHERE  cphh.plan_number = cph.plan_number         AND    cphh.plan_status IN ('APPROVING', 'APPROVED', 'ORDERED'))group by cph.PLAN_NUMBER,cph.PLAN_STATUS,cph.VERSION_NUM;---show plan's sum_price by categoryselect sum(cpl.unit_price*cpl.quantity) from cux_pr_plan_lines cpl ,cux_pr_plan_headers cph where       cpl.header_id =cph.header_id          and cph.plan_number = 'S201706015'      and  (        SELECT t.segment1 || '.' || t.segment2 || '.' || t.segment3 category_code        FROM   mtl_categories t        WHERE  t.category_id = cpl.category_id) =       (SELECT distinct t.segment1 || '.' || t.segment2 || '.' || t.segment3 category_code         FROM   mtl_categories t         WHERE  t.DESCRIPTION like '%混凝土高精砌块%'  )  ;---show plan's sum_price by category，原来的写法select sum(cpl.unit_price*cpl.quantity) from cux_pr_plan_lines cpl ,cux_pr_plan_headers cph where       cpl.header_id =cph.header_id          and cph.plan_number = 'S201710088'      and cpl.category_id in (        SELECT MCK.CATEGORY_ID     FROM   MTL_CATEGORIES_KFV        MCK      ,MTL_CATEGORY_SETS         MCS      ,MTL_DEFAULT_CATEGORY_SETS MDCS      ,MTL_CATEGORIES            MCWHERE  MCK.ENABLED_FLAG = 'Y'AND    SYSDATE BETWEEN NVL(MCK.START_DATE_ACTIVE, SYSDATE) AND       NVL(MCK.END_DATE_ACTIVE, SYSDATE)AND    MCS.CATEGORY_SET_ID = MDCS.CATEGORY_SET_IDAND    MDCS.FUNCTIONAL_AREA_ID = 2 --采购分类AND    MCK.STRUCTURE_ID = MCS.STRUCTURE_IDAND    NVL(MCK.DISABLE_DATE, SYSDATE + 1) > SYSDATEAND    (MCS.VALIDATE_FLAG = 'Y' AND      MCK.CATEGORY_ID IN      (SELECT MCSV.CATEGORY_ID         FROM   MTL_CATEGORY_SET_VALID_CATS MCSV         WHERE  MCSV.CATEGORY_SET_ID = MCS.CATEGORY_SET_ID) OR      MCS.VALIDATE_FLAG <> 'Y')AND    MCK.CATEGORY_ID = MC.CATEGORY_IDand MC.DESCRIPTION like '建筑装饰材料.水泥及水泥制品.混凝土砖、砌块.%') ;---show one contract's sum_price ,query by plan_numberselect sum(cpl.unit_price*cpl.quantity) from cux_pr_plan_lines cpl where cpl.header_id in(              select cph.a  from   (select cph3.plan_number,cph3.contract_id,max(cph3.header_id) a from                cux_pr_plan_headers cph3 where cph3.plan_status='ORDERED' group by cph3.plan_number,cph3.contract_id) cph       ,cux_pr_plan_headers cph2 where cph2.contract_id=cph.contract_id          and cph2.plan_number = 'S201706057'   ---source pr_plan         and cph2.version_num=1       )and  (        SELECT t.segment1 || '.' || t.segment2 || '.' || t.segment3 category_code        FROM   mtl_categories t        WHERE  t.category_id = cpl.category_id) =       (SELECT distinct t.segment1 || '.' || t.segment2 || '.' || t.segment3 category_code         FROM   mtl_categories t         WHERE  t.DESCRIPTION like '%混凝土高精砌块%'  ) ;---show one contract's sum_price ,query by plan_number  with out consider versionsselect sum(cpl.unit_price*cpl.quantity) from cux_pr_plan_lines cpl where cpl.header_id in(              select cph.header_id  from   cux_pr_plan_headers cph       ,cux_pr_plan_headers cph2 where cph.contract_id = cph2.contract_id        and cph2.plan_number = 'S201706015'   ---source pr_plan         and cph2.version_num=1               ---version_control        and cph.plan_status='ORDERED')and  (        SELECT t.segment1 || '.' || t.segment2 || '.' || t.segment3 category_code        FROM   mtl_categories t        WHERE  t.category_id = cpl.category_id) =       (SELECT distinct t.segment1 || '.' || t.segment2 || '.' || t.segment3 category_code         FROM   mtl_categories t         WHERE  t.DESCRIPTION like '%混凝土高精砌块%'  ) ;select cppl.ITEM_ID,msib.SEGMENT1,cppl.UNIT_PRICE,cppl.PLAN_QUANTITY,cpph.PLAN_NUMBER,cpph.CONTRACT_ID ,cppl.AG_HEADER_ID,cppl.AG_LINE_IDfrom cux_pr_plan_headers cpph,CUX.CUX_PR_PLAN_LINES cppl,mtl_system_items_b msib where cpph.HEADER_ID=cppl.HEADER_ID and  msib.inventory_item_id = cppl.item_id and msib.ORGANIZATION_ID=460and cpph.PLAN_NUMBER='S201706028';----base sql check category is all in 不知道为啥，用这个方法取出来的值有点怪，会少值，换了一个更加简单的方法SELECT mck.category_id      ,fnd_flex_ext.get_segs('INV',                             'MCAT',                             mck.structure_id,                             mck.category_id) concatenated_segments      ,mc.descriptionFROM   mtl_categories_kfv        mck      ,mtl_category_sets         mcs      ,mtl_default_category_sets mdcs      ,mtl_categories            mcWHERE  mck.enabled_flag = 'Y'AND    SYSDATE BETWEEN nvl(mck.start_date_active, SYSDATE) AND       nvl(mck.end_date_active, SYSDATE)AND    mcs.category_set_id = mdcs.category_set_idAND    mdcs.functional_area_id = 2 --采购分类AND    mck.structure_id = mcs.structure_idAND    nvl(mck.disable_date, SYSDATE + 1) > SYSDATEAND    (mcs.validate_flag = 'Y' AND      mck.category_id IN      (SELECT mcsv.category_id         FROM   mtl_category_set_valid_cats mcsv         WHERE  mcsv.category_set_id = mcs.category_set_id) OR      mcs.validate_flag <> 'Y')AND    mck.category_id = mc.category_idAND    mc.description LIKE '%PVC%';